<UserControl
    x:Class="HillsCafeManagement.Views.Admin.Payslip_Requests.Payslip"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="clr-namespace:HillsCafeManagement.ViewModels"
    xmlns:local="clr-namespace:HillsCafeManagement.Helpers"
    Background="#2A2B40">

    <UserControl.Resources>
        <!-- FIX: Correct reference to converter in Helpers namespace -->
        <local:EmptyStringToVisibilityConverter x:Key="StringToVisibilityConverter" />
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock Text="📄 Payslip Requests"
                   FontSize="28"
                   FontWeight="Bold"
                   Foreground="White"
                   Margin="0,0,0,20" />

        <!-- Search and Refresh -->
        <Grid Grid.Row="1" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <Border Background="#D9D9D9" CornerRadius="10" Padding="8">
                <TextBox x:Name="SearchBox"
                         Background="Transparent"
                         BorderThickness="0"
                         FontSize="14"
                         Foreground="Black"
                         VerticalContentAlignment="Center"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />
            </Border>

            <Button Grid.Column="1"
                    Content="🔄 Refresh"
                    Background="#6378FF"
                    Foreground="White"
                    FontSize="12"
                    Padding="12,8"
                    BorderThickness="0"
                    Margin="10,0,0,0"
                    Command="{Binding RefreshCommand}">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="8" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Button.Template>
            </Button>
        </Grid>

        <!-- Status Message -->
        <Border Grid.Row="2" Background="#4CAF50" CornerRadius="5" Padding="8,4" Margin="0,0,0,10">
            <Border.Style>
                <Style TargetType="Border">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding StatusMessage, Converter={StaticResource StringToVisibilityConverter}}" Value="Visible">
                            <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>
            <TextBlock Text="{Binding StatusMessage}" Foreground="White" FontSize="12" FontWeight="Medium" HorizontalAlignment="Center" />
        </Border>

        <!-- Loading Indicator -->
        <Grid Grid.Row="2" Margin="0,0,0,10">
            <Grid.Style>
                <Style TargetType="Grid">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsLoading}" Value="True">
                            <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Grid.Style>
            <Border Background="#FF9800" CornerRadius="5" Padding="8,4">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <TextBlock Text="⏳ Loading..." Foreground="White" FontSize="12" FontWeight="Medium" />
                </StackPanel>
            </Border>
        </Grid>

        <!-- DataGrid -->
        <DataGrid Grid.Row="3"
                  ItemsSource="{Binding PayslipRequests}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  IsReadOnly="True"
                  Background="#2A2B40"
                  Foreground="Black"
                  RowBackground="#D9D9D9"
                  AlternatingRowBackground="#EFEFEF"
                  BorderThickness="0"
                  GridLinesVisibility="None"
                  ColumnHeaderHeight="40"
                  RowHeight="50">

            <DataGrid.Resources>
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="#6378FF" />
                    <Setter Property="Foreground" Value="White" />
                    <Setter Property="FontWeight" Value="Bold" />
                    <Setter Property="HorizontalContentAlignment" Value="Center" />
                    <Setter Property="Padding" Value="8" />
                </Style>
                <Style TargetType="DataGridCell">
                    <Setter Property="TextBlock.TextAlignment" Value="Center" />
                    <Setter Property="VerticalAlignment" Value="Center" />
                    <Setter Property="Padding" Value="8" />
                </Style>
            </DataGrid.Resources>

            <DataGrid.Columns>
                <DataGridTextColumn Header="Employee ID" Binding="{Binding EmployeeId}" Width="100" />
                <DataGridTextColumn Header="Full Name" Binding="{Binding FullName}" Width="150" />
                <DataGridTextColumn Header="Request Date" Binding="{Binding RequestDate, StringFormat={}{0:MM/dd/yyyy}}" Width="120" />

                <!-- Status -->
                <DataGridTemplateColumn Header="Status" Width="100">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Border CornerRadius="12" Padding="8,4" HorizontalAlignment="Center">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Status}" Value="Pending">
                                                <Setter Property="Background" Value="#FF9800" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Status}" Value="Approved">
                                                <Setter Property="Background" Value="#4CAF50" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Status}" Value="Denied">
                                                <Setter Property="Background" Value="#F44336" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Status}" Value="Done">
                                                <Setter Property="Background" Value="#2196F3" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <TextBlock Text="{Binding Status}" Foreground="White" FontSize="10" FontWeight="Bold" HorizontalAlignment="Center" />
                            </Border>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Actions -->
                <DataGridTemplateColumn Header="Actions" Width="280">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <!-- Approve -->
                                <Button Content="✔ Approve"
                                        Background="#4CAF50"
                                        Foreground="White"
                                        FontSize="10"
                                        Padding="8,4"
                                        BorderThickness="0"
                                        Margin="2"
                                        Command="{Binding DataContext.ApproveCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}" />
                                <!-- Deny -->
                                <Button Content="✖ Deny"
                                        Background="#F44336"
                                        Foreground="White"
                                        FontSize="10"
                                        Padding="8,4"
                                        BorderThickness="0"
                                        Margin="2"
                                        Command="{Binding DataContext.DenyCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}" />
                                <!-- Done -->
                                <Button Content="✓ Done"
                                        Background="#2196F3"
                                        Foreground="White"
                                        FontSize="10"
                                        Padding="8,4"
                                        BorderThickness="0"
                                        Margin="2"
                                        Command="{Binding DataContext.DoneCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}" />
                                <!-- Delete -->
                                <Button Content="🗑 Delete"
                                        Background="#9E9E9E"
                                        Foreground="White"
                                        FontSize="10"
                                        Padding="8,4"
                                        BorderThickness="0"
                                        Margin="2"
                                        Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}" />
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Footer -->
        <Border Grid.Row="4"
                Background="#34374C"
                CornerRadius="8"
                Padding="12,8"
                Margin="0,10,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock Text="{Binding PayslipRequests.Count, StringFormat='Total Requests: {0}'}"
                           Foreground="White"
                           FontSize="12"
                           VerticalAlignment="Center" />
                <TextBlock Grid.Column="1"
                           Text="{Binding StatusMessage}"
                           Foreground="#B0BEC5"
                           FontSize="11"
                           VerticalAlignment="Center" />
            </Grid>
        </Border>
    </Grid>
</UserControl>