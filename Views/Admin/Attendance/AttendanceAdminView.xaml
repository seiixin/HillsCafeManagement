<UserControl x:Class="HillsCafeManagement.Views.Admin.Attendance.AttendanceAdminView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:helpers="clr-namespace:HillsCafeManagement.Helpers"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:models="clr-namespace:HillsCafeManagement.Models"
             xmlns:att="clr-namespace:HillsCafeManagement.Views.Admin.Attendance"
             mc:Ignorable="d"
             Background="#2A2B40"
             d:DesignHeight="600"
             d:DesignWidth="900">

    <!-- ========================= Resources ========================= -->
    <UserControl.Resources>
        <helpers:EmptyStringToVisibilityConverter x:Key="EmptyStringToVisibilityConverter" />

        <!-- Button look -->
        <Style x:Key="StyledButton" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.9"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- DataGrid header style -->
        <Style x:Key="GridHeader" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#6378FF"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Height" Value="40"/>
        </Style>

        <!-- Allowed statuses for editing -->
        <x:Array x:Key="EditableStatuses" Type="{x:Type models:LeaveStatus}">
            <models:LeaveStatus>Pending</models:LeaveStatus>
            <models:LeaveStatus>Approved</models:LeaveStatus>
            <models:LeaveStatus>Rejected</models:LeaveStatus>
        </x:Array>

        <!-- Combo look inside cells -->
        <Style x:Key="CellCombo" TargetType="ComboBox">
            <Setter Property="IsEditable" Value="False"/>
            <Setter Property="IsReadOnly" Value="True"/>
        </Style>
        <Style x:Key="CellComboEditing" TargetType="ComboBox" BasedOn="{StaticResource CellCombo}">
            <Setter Property="SelectedItem"
                    Value="{Binding Status, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
        </Style>
    </UserControl.Resources>

    <!-- ========================= Layout ========================= -->
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header row with title (left) and Work Schedules button (right) -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Text="📅 Attendance &amp; Leave Admin"
                       FontSize="28"
                       FontWeight="Bold"
                       Foreground="White"
                       Margin="0,0,16,0"
                       VerticalAlignment="Center"/>

            <Button Grid.Column="1"
                    Content="Work Schedules"
                    Background="#5469D4"
                    Style="{StaticResource StyledButton}"
                    Click="OpenWorkSchedules_Click"/>
        </Grid>

        <TabControl Grid.Row="1"
                    Margin="0,16,0,0"
                    Background="Transparent"
                    BorderThickness="0"
                    Padding="0">

            <!-- ===================== ATTENDANCE ===================== -->
            <TabItem Header="Attendance">
                <Grid Background="Transparent" Margin="0,10,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Filters -->
                    <Grid Grid.Row="0" Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Horizontal"
                                    VerticalAlignment="Center"
                                    Margin="0,0,10,0">
                            <TextBlock Text="Date:"
                                       Foreground="White"
                                       VerticalAlignment="Center"
                                       Margin="0,0,5,0"/>
                            <DatePicker SelectedDate="{Binding FilterDate, Mode=TwoWay}"
                                        Width="140"
                                        Margin="0,0,10,0"/>
                            <TextBlock Text="Employee ID:"
                                       Foreground="White"
                                       VerticalAlignment="Center"
                                       Margin="0,0,5,0"/>
                            <TextBox Text="{Binding FilterEmployeeId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     Width="120"
                                     Margin="0,0,10,0"/>
                        </StackPanel>

                        <Button Grid.Column="1"
                                Content="Filter"
                                Command="{Binding FilterCommand}"
                                Background="#6378FF"
                                Style="{StaticResource StyledButton}"/>
                    </Grid>

                    <!-- Attendance grid -->
                    <DataGrid Grid.Row="1"
                              ItemsSource="{Binding Attendances}"
                              SelectedItem="{Binding SelectedAttendance, Mode=TwoWay}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              IsReadOnly="False"
                              Background="#2A2B40"
                              Foreground="Black"
                              RowBackground="#D9D9D9"
                              AlternatingRowBackground="#D9D9D9"
                              BorderThickness="0"
                              GridLinesVisibility="None"
                              RowHeight="40"
                              Margin="0,10,0,10"
                              ColumnHeaderHeight="40">
                        <DataGrid.Resources>
                            <Style TargetType="DataGridColumnHeader"
                                   BasedOn="{StaticResource GridHeader}"/>
                        </DataGrid.Resources>

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID"
                                                Binding="{Binding Id}"
                                                IsReadOnly="True"
                                                Width="*"/>
                            <DataGridTextColumn Header="Employee ID"
                                                Binding="{Binding EmployeeId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                Width="*"/>
                            <DataGridTextColumn Header="Date"
                                                Binding="{Binding Date, StringFormat=\{0:yyyy-MM-dd\}}"
                                                Width="*"/>
                            <DataGridTextColumn Header="Time In"
                                                Binding="{Binding TimeIn, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                Width="*"/>
                            <DataGridTextColumn Header="Time Out"
                                                Binding="{Binding TimeOut, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                Width="*"/>
                            <DataGridTextColumn Header="Status"
                                                Binding="{Binding Status, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- CRUD -->
                    <StackPanel Grid.Row="2"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                Margin="0,10,0,0">
                        <Button Content="Add"
                                Command="{Binding AddCommand}"
                                Background="#28a745"
                                Style="{StaticResource StyledButton}"
                                Margin="0,0,10,0"/>
                        <Button Content="Update"
                                Command="{Binding UpdateCommand}"
                                Background="#ffc107"
                                Foreground="Black"
                                Style="{StaticResource StyledButton}"
                                Margin="0,0,10,0"/>
                        <Button Content="Delete"
                                Command="{Binding DeleteCommand}"
                                Background="#dc3545"
                                Style="{StaticResource StyledButton}"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- ===================== LEAVE REQUESTS ===================== -->
            <TabItem Header="Leave Requests">
                <Grid Background="Transparent" Margin="0,10,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Filters -->
                    <Grid Grid.Row="0" Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Horizontal"
                                    VerticalAlignment="Center"
                                    Margin="0,0,10,0">
                            <TextBlock Text="Employee ID:"
                                       Foreground="White"
                                       VerticalAlignment="Center"
                                       Margin="0,0,5,0"/>
                            <TextBox Text="{Binding LeaveFilterEmployeeId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     Width="120"
                                     Margin="0,0,10,0"/>

                            <TextBlock Text="From:"
                                       Foreground="White"
                                       VerticalAlignment="Center"
                                       Margin="0,0,5,0"/>
                            <DatePicker SelectedDate="{Binding LeaveFrom, Mode=TwoWay}"
                                        Width="140"
                                        Margin="0,0,10,0"/>

                            <TextBlock Text="To:"
                                       Foreground="White"
                                       VerticalAlignment="Center"
                                       Margin="0,0,5,0"/>
                            <DatePicker SelectedDate="{Binding LeaveTo, Mode=TwoWay}"
                                        Width="140"
                                        Margin="0,0,10,0"/>

                            <TextBlock Text="Status:"
                                       Foreground="White"
                                       VerticalAlignment="Center"
                                       Margin="0,0,5,0"/>
                            <ComboBox SelectedValue="{Binding LeaveFilterStatus, Mode=TwoWay}"
                                      SelectedValuePath="Tag"
                                      Width="140"
                                      Margin="0,0,10,0">
                                <ComboBoxItem Content="Pending"  Tag="{x:Static models:LeaveStatus.Pending}"/>
                                <ComboBoxItem Content="Approved" Tag="{x:Static models:LeaveStatus.Approved}"/>
                                <ComboBoxItem Content="Rejected" Tag="{x:Static models:LeaveStatus.Rejected}"/>
                            </ComboBox>
                        </StackPanel>

                        <Button Grid.Column="1"
                                Content="Filter"
                                Command="{Binding LeaveFilterCommand}"
                                Background="#6378FF"
                                Style="{StaticResource StyledButton}"/>
                    </Grid>

                    <!-- Leave grid -->
                    <DataGrid x:Name="LeaveGrid"
                              Grid.Row="1"
                              ItemsSource="{Binding LeaveRequests}"
                              SelectedItem="{Binding SelectedLeave, Mode=TwoWay}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              IsReadOnly="False"
                              SelectionUnit="FullRow"
                              Background="#2A2B40"
                              Foreground="Black"
                              RowBackground="#D9D9D9"
                              AlternatingRowBackground="#D9D9D9"
                              BorderThickness="0"
                              GridLinesVisibility="None"
                              RowHeight="40"
                              Margin="0,10,0,10"
                              ColumnHeaderHeight="40"
                              SelectionChanged="LeaveGrid_SelectionChanged"
                              RowEditEnding="LeaveGrid_RowEditEnding"
                              CurrentCellChanged="LeaveGrid_CurrentCellChanged">
                        <DataGrid.Resources>
                            <Style TargetType="DataGridColumnHeader"
                                   BasedOn="{StaticResource GridHeader}"/>
                        </DataGrid.Resources>

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID"
                                                Binding="{Binding Id}"
                                                IsReadOnly="True"
                                                Width="*"/>
                            <DataGridTextColumn Header="Employee ID"
                                                Binding="{Binding EmployeeId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                Width="*"/>
                            <DataGridTextColumn Header="Type"
                                                Binding="{Binding LeaveType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                Width="*"/>
                            <DataGridTextColumn Header="Reason"
                                                Binding="{Binding Reason, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                Width="2*"/>
                            <DataGridTextColumn Header="From"
                                                Binding="{Binding DateFrom, StringFormat=\{0:yyyy-MM-dd\}}"
                                                Width="*"/>
                            <DataGridTextColumn Header="To"
                                                Binding="{Binding DateTo, StringFormat=\{0:yyyy-MM-dd\}}"
                                                Width="*"/>
                            <DataGridCheckBoxColumn Header="Half Day"
                                                    Binding="{Binding HalfDay, Mode=TwoWay}"
                                                    Width="*"/>

                            <!-- Status dropdown -->
                            <DataGridComboBoxColumn Header="Status"
                                                    ItemsSource="{StaticResource EditableStatuses}"
                                                    SelectedItemBinding="{Binding Status, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                    ElementStyle="{StaticResource CellCombo}"
                                                    EditingElementStyle="{StaticResource CellComboEditing}"
                                                    Width="*"/>

                            <!-- Hidden columns -->
                            <DataGridTextColumn Header="Approver UserId"
                                                Binding="{Binding ApproverUserId}"
                                                Visibility="Collapsed"/>
                            <DataGridTextColumn Header="Approved At"
                                                Binding="{Binding ApprovedAt, StringFormat=\{0:yyyy-MM-dd HH:mm\}}"
                                                Visibility="Collapsed"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Actions -->
                    <StackPanel Grid.Row="2"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                Margin="0,10,0,0">
                        <Button Content="Create"
                                Command="{Binding LeaveCreateCommand}"
                                Background="#28a745"
                                Style="{StaticResource StyledButton}"
                                Margin="0,0,10,0"/>
                        <Button Content="Update"
                                Command="{Binding LeaveUpdateCommand}"
                                Background="#ffc107"
                                Foreground="Black"
                                Style="{StaticResource StyledButton}"
                                Margin="0,0,10,0"/>
                        <Button Content="Delete"
                                Command="{Binding LeaveDeleteCommand}"
                                Background="#dc3545"
                                Style="{StaticResource StyledButton}"
                                Margin="0,0,10,0"/>

                        <Button Content="Approve"
                                Command="{Binding LeaveApproveCommand}"
                                Background="#4caf50"
                                Style="{StaticResource StyledButton}"
                                Margin="0,0,10,0"/>
                        <Button Content="Reject"
                                Command="{Binding LeaveRejectCommand}"
                                Background="#f44336"
                                Style="{StaticResource StyledButton}"
                                Margin="0,0,10,0"/>
                        <Button Content="Cancel"
                                Command="{Binding LeaveCancelCommand}"
                                Background="#9e9e9e"
                                Style="{StaticResource StyledButton}"/>
                    </StackPanel>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
