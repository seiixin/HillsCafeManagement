<UserControl
    x:Class="HillsCafeManagement.Views.Admin.Payroll.PositionSalaryEdit"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    d:DesignWidth="520" d:DesignHeight="640"
    Background="#99000000"
    Focusable="True">

    <!-- Centered card (same vibe as AddEditPayroll) -->
    <Border
        Width="520"
        Background="White"
        Padding="20"
        CornerRadius="10"
        VerticalAlignment="Center"
        HorizontalAlignment="Center">

        <!-- Scrollable content -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="580">
            <StackPanel>

                <!-- Title -->
                <TextBlock Text="Positions &amp; Salaries"
                           FontSize="20"
                           FontWeight="Bold"
                           Foreground="#6378FF"
                           Margin="0,0,0,14"
                           TextAlignment="Center"/>

                <!-- Toolbar -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,10">
                    <Button Content="Reload"
                            Command="{Binding ReloadCommand}"
                            Margin="0,0,8,0"
                            Padding="8,4"/>
                    <Button Content="Add Row"
                            Command="{Binding AddCommand}"
                            Margin="0,0,8,0"
                            Padding="8,4"/>
                    <Button Content="Save"
                            Command="{Binding SaveCommand}"
                            Background="#57B894"
                            Foreground="White"
                            Padding="8,4"/>
                </StackPanel>

                <!-- Quick instructions -->
                <TextBlock Text="Tip: Type a Position and Daily Rate below. Use Save to persist to DB."
                           Foreground="#666"
                           Margin="0,0,0,8"/>

                <!-- Editable grid of presets (compact) -->
                <DataGrid
                    ItemsSource="{Binding Rates}"
                    SelectedItem="{Binding Selected, Mode=TwoWay}"
                    AutoGenerateColumns="False"
                    CanUserAddRows="False"
                    CanUserDeleteRows="True"
                    HeadersVisibility="Column"
                    GridLinesVisibility="None"
                    RowHeight="34"
                    ColumnHeaderHeight="34"
                    Margin="0,0,0,10"
                    IsReadOnly="False">

                    <DataGrid.Resources>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="#6378FF"/>
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                        </Style>
                    </DataGrid.Resources>

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Position"
                                            Width="*"
                                            Binding="{Binding Position, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                        <DataGridTextColumn Header="Daily Rate"
                                            Width="150"
                                            Binding="{Binding DailyRate, Mode=TwoWay, StringFormat=\{0:F2\}, UpdateSourceTrigger=PropertyChanged}"/>

                        <DataGridCheckBoxColumn Header="Active"
                                                Width="90"
                                                Binding="{Binding IsActive, Mode=TwoWay}"/>

                        <DataGridTextColumn Header="Updated"
                                            Width="170"
                                            IsReadOnly="True"
                                            Binding="{Binding UpdatedAt, StringFormat=\{0:yyyy-MM-dd HH:mm\}}"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Footer status + Close -->
                <DockPanel>
                    <TextBlock Text="{Binding Status}"
                               Foreground="#444"
                               VerticalAlignment="Center"/>
                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                        <TextBlock Text="Busy: " Foreground="#666" Margin="0,0,6,0" VerticalAlignment="Center"/>
                        <!-- FIX: make binding OneWay to avoid writing back to read-only IsBusy -->
                        <CheckBox IsChecked="{Binding IsBusy, Mode=OneWay}"
                                  IsEnabled="False"
                                  Focusable="False"
                                  VerticalAlignment="Center"
                                  Margin="0,0,12,0"/>
                        <Button Content="Close"
                                Command="{Binding CloseCommand}"
                                Background="#6378FF"
                                Foreground="White"
                                Padding="8,4"/>
                    </StackPanel>
                </DockPanel>

            </StackPanel>
        </ScrollViewer>
    </Border>
</UserControl>
